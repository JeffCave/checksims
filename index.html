<!DOCTYPE html>
<html>
<head>
 <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js'></script>
 <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js'></script>
 <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js'></script>

 <script src="https://d3js.org/d3.v4.min.js"></script>

 <script type="text/javascript" src="./scripts/visualizations/force.js"></script>
 <script type="text/javascript" src="./scripts/allLibs.js"></script>
 <script type="text/javascript" src="./scripts/ChecksimsCommandLine.js"></script>
 <script>
	/*
	global ChecksimsCommandLine
	global JSZip
	*/
	'use strict';

	window.addEventListener('load',function(){
		let checker = new ChecksimsCommandLine();
		let button = document.querySelector('button');
		let upload = document.querySelector("input[name='zip']");
		let outputFlds = Array.from(document.querySelectorAll('#results > details'))
			.reduce(function(a,d){
				if(d.dataset.type){
					a[d.dataset.type] = d;
				}
				return a;
			},{})
			;

		button.addEventListener('click',function(e){
			checker.runHtml(outputFlds);
		});

		upload.addEventListener('change',function(e){
			Array.from(e.target.files).forEach(function(file){
				if (!file.type === 'application/x-zip-compressed'){
					return;
				}
				checker
					.attachSubmissions(file)
					.then(function(){
						button.disabled = false;
						let ul = document.querySelector("ul");
						let entries = [];
						checker.submissions.forEach(function(path,entry) {
							entries.push(entry);
						});
						ul.innerHTML = entries.sort((a,b)=>{
								a = a.name;
								b = b.name;
								if(a===b) return 0;
								if(a<b) return -1;
								return 1;
							})
							.map((entry)=>{
								return '<li>'+entry.name+'</li>';
							})
							.join('')
							;
					})
					;
			});
		});
	});
 </script>
 <style>
	body{
		font-family:sans-serif;
	}
	table{
		border-collapse:collapse;
	}
	tbody {
		background-color:green;
	}
	td {
		padding:0.2em;
		background-color:red;
		font-weight:bold;
		font-family:monospace;
		text-align:right;
		color:white;
		border:1px solid black;
	}
	th {
		background-color:white;
	}
	textarea{
		width:80%;
	}

	#results > details > * {
		margin:2em;
	}
	#results > details > summary {
		margin:0;
		background-color:black;
		color:white;
		font-weight:bold;
	}
 </style>
</head>
<body>
 <fieldset>
  <input name='zip' type="file" multiple />
  <button name='run' disabled>Run</button>
  <details open>
   <summary>Files</summary>
   <ul></ul>
  </details>
 </fieldset>
 <section id='results'>
  <details data-type='force'>
   <summary>Force</summary>
   <svg style="padding:0;height:300px;width:300px;list-style-type:none;position:relative;" width="300" height="300"></svg>
   <ul class='result' style="padding:0;height:300px;width:300px;list-style-type:none;position:relative;display:none;"></ul>
  </details>
  <details data-type='lst'>
   <summary>Listing</summary>
   <table class='result'></table>
  </details>
  <details data-type='html'>
   <summary>HTML</summary>
   <div class='result'></div>
  </details>
  <details data-type='csv'>
   <summary>CSV</summary>
   <textarea class='result'></textarea>
  </details>
 </section>
</body>
</html>
